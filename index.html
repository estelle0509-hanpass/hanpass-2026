   1	<!DOCTYPE html>
     2	<html lang="ko">
     3	<head>
     4	  <meta charset="UTF-8">
     5	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
     6	  <title>HanPass 2026 Dashboard</title>
     7	  <style>
     8	    * {
     9	      margin: 0;
    10	      padding: 0;
    11	      box-sizing: border-box;
    12	    }
    13	
    14	    body {
    15	      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    16	      background: #f5f7fa;
    17	      color: #333;
    18	      line-height: 1.6;
    19	    }
    20	
    21	    .container {
    22	      max-width: 1400px;
    23	      margin: 0 auto;
    24	      padding: 20px;
    25	    }
    26	
    27	    header {
    28	      background: white;
    29	      padding: 20px;
    30	      border-radius: 12px;
    31	      margin-bottom: 20px;
    32	      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    33	      display: flex;
    34	      justify-content: space-between;
    35	      align-items: center;
    36	      flex-wrap: wrap;
    37	    }
    38	
    39	    header h1 {
    40	      color: #2c3e50;
    41	      font-size: 1.5em;
    42	    }
    43	
    44	    .header-right {
    45	      display: flex;
    46	      gap: 10px;
    47	      align-items: center;
    48	    }
    49	
    50	    .btn {
    51	      background: #2196F3;
    52	      color: white;
    53	      border: none;
    54	      padding: 10px 20px;
    55	      border-radius: 8px;
    56	      cursor: pointer;
    57	      font-size: 0.9em;
    58	      font-weight: 600;
    59	      transition: background 0.2s;
    60	    }
    61	
    62	    .btn:hover {
    63	      background: #1976D2;
    64	    }
    65	
    66	    .timestamp {
    67	      color: #999;
    68	      font-size: 0.85em;
    69	    }
    70	
    71	    .vision-banner {
    72	      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    73	      border-radius: 8px;
    74	      padding: 15px;
    75	      text-align: center;
    76	      font-size: 1.1em;
    77	      font-weight: 700;
    78	      color: white;
    79	      margin-bottom: 20px;
    80	      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    81	    }
    82	
    83	    .tabs {
    84	      display: flex;
    85	      gap: 10px;
    86	      margin-bottom: 20px;
    87	      border-bottom: 2px solid #e5e5e5;
    88	    }
    89	
    90	    .tab {
    91	      background: transparent;
    92	      border: none;
    93	      padding: 12px 24px;
    94	      cursor: pointer;
    95	      font-size: 1em;
    96	      font-weight: 600;
    97	      color: #666;
    98	      border-bottom: 3px solid transparent;
    99	      transition: all 0.2s;
   100	    }
   101	
   102	    .tab.active {
   103	      color: #2196F3;
   104	      border-bottom-color: #2196F3;
   105	    }
   106	
   107	    .tab:hover {
   108	      color: #2196F3;
   109	    }
   110	
   111	    .tab-content {
   112	      display: none;
   113	    }
   114	
   115	    .tab-content.active {
   116	      display: block;
   117	    }
   118	
   119	    .kpi-group {
   120	      background: white;
   121	      border-radius: 12px;
   122	      padding: 20px;
   123	      margin-bottom: 20px;
   124	      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
   125	    }
   126	
   127	    .kpi-header {
   128	      display: flex;
   129	      justify-content: space-between;
   130	      align-items: center;
   131	      cursor: pointer;
   132	      padding: 10px;
   133	      border-radius: 8px;
   134	      transition: background 0.2s;
   135	    }
   136	
   137	    .kpi-header:hover {
   138	      background: #f8f9fa;
   139	    }
   140	
   141	    .kpi-title {
   142	      font-size: 1.3em;
   143	      font-weight: 700;
   144	      color: #2c3e50;
   145	    }
   146	
   147	    .kpi-count {
   148	      background: #2196F3;
   149	      color: white;
   150	      padding: 5px 15px;
   151	      border-radius: 20px;
   152	      font-size: 0.9em;
   153	      font-weight: 600;
   154	      margin-right: 10px;
   155	    }
   156	
   157	    .kpi-arrow {
   158	      font-size: 1.2em;
   159	      color: #666;
   160	      transition: transform 0.3s;
   161	      display: inline-block;
   162	    }
   163	
   164	    .kpi-details.active ~ .kpi-header .kpi-arrow {
   165	      transform: rotate(180deg);
   166	    }
   167	
   168	    .kpi-details {
   169	      max-height: 0;
   170	      overflow: hidden;
   171	      transition: max-height 0.3s ease-out;
   172	    }
   173	
   174	    .kpi-details.active {
   175	      max-height: 10000px;
   176	      transition: max-height 0.5s ease-in;
   177	    }
   178	
   179	    .detail-section {
   180	      margin-top: 15px;
   181	      padding-top: 15px;
   182	      border-top: 2px solid #f0f0f0;
   183	    }
   184	
   185	    .detail-header {
   186	      display: flex;
   187	      align-items: center;
   188	      justify-content: space-between;
   189	      gap: 10px;
   190	      margin-bottom: 10px;
   191	      padding: 10px;
   192	      background: #f8f9fa;
   193	      border-radius: 8px;
   194	      cursor: pointer;
   195	      transition: background 0.2s;
   196	    }
   197	
   198	    .detail-header:hover {
   199	      background: #e9ecef;
   200	    }
   201	
   202	    .detail-left {
   203	      display: flex;
   204	      align-items: center;
   205	      gap: 10px;
   206	      flex: 1;
   207	    }
   208	
   209	    .detail-pin {
   210	      font-size: 1.2em;
   211	    }
   212	
   213	    .detail-title {
   214	      font-size: 1.1em;
   215	      font-weight: 600;
   216	      color: #555;
   217	    }
   218	
   219	    .detail-count {
   220	      color: #2196F3;
   221	      font-weight: 600;
   222	      margin-right: 10px;
   223	    }
   224	
   225	    .detail-arrow {
   226	      font-size: 1.1em;
   227	      color: #888;
   228	      transition: transform 0.3s;
   229	      display: inline-block;
   230	    }
   231	
   232	    .detail-content {
   233	      max-height: 0;
   234	      overflow: hidden;
   235	      transition: max-height 0.3s ease-out;
   236	    }
   237	
   238	    .detail-content.active {
   239	      max-height: 5000px;
   240	      transition: max-height 0.5s ease-in;
   241	    }
   242	
   243	    .detail-content.active ~ .detail-header .detail-arrow {
   244	      transform: rotate(180deg);
   245	    }
   246	
   247	    .table-container {
   248	      overflow-x: auto;
   249	    }
   250	
   251	    table {
   252	      width: 100%;
   253	      border-collapse: collapse;
   254	      margin-top: 10px;
   255	    }
   256	
   257	    th, td {
   258	      padding: 12px;
   259	      text-align: left;
   260	      border-bottom: 1px solid #e5e5e5;
   261	    }
   262	
   263	    th {
   264	      background: #f8f9fa;
   265	      color: #555;
   266	      font-weight: 600;
   267	      font-size: 0.9em;
   268	    }
   269	
   270	    td {
   271	      font-size: 0.9em;
   272	      color: #666;
   273	    }
   274	
   275	    .project-link {
   276	      color: #2196F3;
   277	      text-decoration: none;
   278	      font-weight: 600;
   279	      transition: color 0.2s;
   280	    }
   281	
   282	    .project-link:hover {
   283	      color: #1976D2;
   284	      text-decoration: underline;
   285	    }
   286	
   287	    .changed-value {
   288	      color: #2196F3;
   289	      font-weight: 600;
   290	      position: relative;
   291	    }
   292	
   293	    .changed-value::after {
   294	      content: 'ë³€ê²½ë¨';
   295	      background: #2196F3;
   296	      color: white;
   297	      font-size: 10px;
   298	      padding: 2px 6px;
   299	      border-radius: 10px;
   300	      margin-left: 6px;
   301	    }
   302	
   303	    .edit-icon {
   304	      cursor: pointer;
   305	      font-size: 1.2em;
   306	      transition: transform 0.2s;
   307	    }
   308	
   309	    .edit-icon:hover {
   310	      transform: scale(1.2);
   311	    }
   312	
   313	    .modal {
   314	      display: none;
   315	      position: fixed;
   316	      top: 0;
   317	      left: 0;
   318	      width: 100%;
   319	      height: 100%;
   320	      background: rgba(0,0,0,0.5);
   321	      z-index: 1000;
   322	      justify-content: center;
   323	      align-items: center;
   324	    }
   325	
   326	    .modal.active {
   327	      display: flex;
   328	    }
   329	
   330	    .modal-content {
   331	      background: white;
   332	      border-radius: 12px;
   333	      padding: 30px;
   334	      width: 90%;
   335	      max-width: 600px;
   336	      max-height: 90vh;
   337	      overflow-y: auto;
   338	    }
   339	
   340	    .modal-header {
   341	      display: flex;
   342	      justify-content: space-between;
   343	      align-items: center;
   344	      margin-bottom: 20px;
   345	    }
   346	
   347	    .modal-header h2 {
   348	      color: #2c3e50;
   349	    }
   350	
   351	    .close-btn {
   352	      background: none;
   353	      border: none;
   354	      font-size: 1.5em;
   355	      cursor: pointer;
   356	      color: #999;
   357	    }
   358	
   359	    .close-btn:hover {
   360	      color: #333;
   361	    }
   362	
   363	    .form-group {
   364	      margin-bottom: 20px;
   365	    }
   366	
   367	    .form-group label {
   368	      display: block;
   369	      margin-bottom: 8px;
   370	      font-weight: 600;
   371	      color: #555;
   372	    }
   373	
   374	    .form-group input,
   375	    .form-group select {
   376	      width: 100%;
   377	      padding: 10px;
   378	      border: 1px solid #ddd;
   379	      border-radius: 6px;
   380	      font-size: 0.95em;
   381	    }
   382	
   383	    .form-group input[readonly] {
   384	      background: #f5f5f5;
   385	      color: #999;
   386	    }
   387	
   388	    .form-group select[multiple] {
   389	      height: 120px;
   390	    }
   391	
   392	    .form-actions {
   393	      display: flex;
   394	      gap: 10px;
   395	      justify-content: flex-end;
   396	      margin-top: 30px;
   397	    }
   398	
   399	    .btn-primary {
   400	      background: #2196F3;
   401	      color: white;
   402	      padding: 12px 24px;
   403	      border: none;
   404	      border-radius: 8px;
   405	      cursor: pointer;
   406	      font-weight: 600;
   407	    }
   408	
   409	    .btn-primary:hover {
   410	      background: #1976D2;
   411	    }
   412	
   413	    .btn-secondary {
   414	      background: #f0f0f0;
   415	      color: #666;
   416	      padding: 12px 24px;
   417	      border: none;
   418	      border-radius: 8px;
   419	      cursor: pointer;
   420	      font-weight: 600;
   421	    }
   422	
   423	    .btn-secondary:hover {
   424	      background: #e0e0e0;
   425	    }
   426	
   427	    .update-list {
   428	      display: flex;
   429	      flex-direction: column;
   430	      gap: 20px;
   431	    }
   432	
   433	    .update-card {
   434	      background: white;
   435	      border: 1px solid #e5e5e5;
   436	      border-radius: 8px;
   437	      padding: 20px;
   438	      border-left: 4px solid #2196F3;
   439	    }
   440	
   441	    .update-card h3 {
   442	      color: #333;
   443	      margin-bottom: 10px;
   444	      display: flex;
   445	      justify-content: space-between;
   446	      align-items: center;
   447	      font-size: 1.1em;
   448	    }
   449	
   450	    .update-time {
   451	      font-size: 0.85em;
   452	      color: #999;
   453	      font-weight: normal;
   454	    }
   455	
   456	    .update-content {
   457	      margin-top: 12px;
   458	      padding-top: 12px;
   459	      border-top: 1px solid #f0f0f0;
   460	      font-size: 0.95em;
   461	      color: #666;
   462	    }
   463	
   464	    .notion-link {
   465	      display: inline-block;
   466	      margin-top: 10px;
   467	      color: #2196F3;
   468	      text-decoration: none;
   469	      font-weight: 600;
   470	      font-size: 0.9em;
   471	    }
   472	
   473	    .notion-link:hover {
   474	      text-decoration: underline;
   475	    }
   476	
   477	    .loading {
   478	      text-align: center;
   479	      padding: 40px;
   480	      color: #999;
   481	    }
   482	
   483	    .error {
   484	      background: #ffebee;
   485	      border: 1px solid #ef5350;
   486	      border-radius: 8px;
   487	      padding: 15px;
   488	      color: #c62828;
   489	      margin: 20px 0;
   490	    }
   491	
   492	    @media (max-width: 768px) {
   493	      .container {
   494	        padding: 10px;
   495	      }
   496	
   497	      header {
   498	        flex-direction: column;
   499	        gap: 10px;
   500	        align-items: flex-start;
   501	      }
   502	
   503	      header h1 {
   504	        font-size: 1.2em;
   505	      }
   506	
   507	      .header-right {
   508	        width: 100%;
   509	        justify-content: space-between;
   510	      }
   511	
   512	      .tabs {
   513	        overflow-x: auto;
   514	        -webkit-overflow-scrolling: touch;
   515	      }
   516	
   517	      .tab {
   518	        white-space: nowrap;
   519	        font-size: 0.9em;
   520	        padding: 10px 15px;
   521	      }
   522	
   523	      .table-container {
   524	        overflow-x: scroll;
   525	      }
   526	
   527	      table {
   528	        font-size: 0.8em;
   529	      }
   530	
   531	      .modal-content {
   532	        padding: 20px;
   533	        width: 95%;
   534	      }
   535	    }
   536	  </style>
   537	</head>
   538	<body>
   539	  <div class="container">
   540	    <header>
   541	      <h1>ğŸš€ HanPass 2026 Dashboard</h1>
   542	      <div class="header-right">
   543	        <button class="btn" onclick="toggleAllKpis(true)">ğŸ“‚ ì „ì²´ ì—´ê¸°</button>
   544	        <button class="btn" onclick="toggleAllKpis(false)">ğŸ“ ì „ì²´ ë‹«ê¸°</button>
   545	        <button class="btn" onclick="loadData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
   546	        <span class="timestamp" id="timestamp"></span>
   547	      </div>
   548	    </header>
   549	
   550	    <div class="vision-banner">
   551	      ì†ë„ë¡œ ì¥ì•…í•˜ê³  ê²©ì°¨ë¡œ ëë‚¸ë‹¤
   552	    </div>
   553	
   554	    <div class="tabs">
   555	      <button class="tab active" onclick="switchTab('all')">ğŸ“Š ì „ì²´ ë³´ê¸°</button>
   556	      <button class="tab" onclick="switchTab('updates')">ğŸ“ ì—…ë°ì´íŠ¸ ëª¨ì•„ë³´ê¸°</button>
   557	    </div>
   558	
   559	    <div id="all-tab" class="tab-content active">
   560	      <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
   561	    </div>
   562	
   563	    <div id="updates-tab" class="tab-content">
   564	      <div class="loading">ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
   565	    </div>
   566	  </div>
   567	
   568	  <!-- ìˆ˜ì • ëª¨ë‹¬ -->
   569	  <div id="edit-modal" class="modal">
   570	    <div class="modal-content">
   571	      <div class="modal-header">
   572	        <h2>í”„ë¡œì íŠ¸ ìˆ˜ì •</h2>
   573	        <button class="close-btn" onclick="closeEditModal()">&times;</button>
   574	      </div>
   575	      <form id="edit-form" onsubmit="handleEditSubmit(event)">
   576	        <input type="hidden" id="edit-project-id">
   577	        
   578	        <div class="form-group">
   579	          <label>í”„ë¡œì íŠ¸ëª… (ì½ê¸° ì „ìš©)</label>
   580	          <input type="text" id="edit-name" readonly>
   581	        </div>
   582	
   583	        <div class="form-group">
   584	          <label>ëª©í‘œ</label>
   585	          <input type="text" id="edit-goal">
   586	        </div>
   587	
   588	        <div class="form-group">
   589	          <label>êµ­ê°€ (ë‹¤ì¤‘ì„ íƒ)</label>
   590	          <select id="edit-country" multiple></select>
   591	        </div>
   592	
   593	        <div class="form-group">
   594	          <label>ë¶€ì„œ</label>
   595	          <select id="edit-division"></select>
   596	        </div>
   597	
   598	        <div class="form-group">
   599	          <label>ë‹´ë‹¹ì (ì½ê¸° ì „ìš©)</label>
   600	          <input type="text" id="edit-owner" readonly>
   601	        </div>
   602	
   603	        <div class="form-group">
   604	          <label>ìƒíƒœ</label>
   605	          <select id="edit-status"></select>
   606	        </div>
   607	
   608	        <div class="form-group">
   609	          <label>ì§„í–‰ë¥  (%)</label>
   610	          <input type="number" id="edit-progress" min="0" max="100">
   611	        </div>
   612	
   613	        <div class="form-group">
   614	          <label>ë§ˆê°ì¼</label>
   615	          <input type="date" id="edit-deadline">
   616	        </div>
   617	
   618	        <div class="form-actions">
   619	          <button type="button" class="btn-secondary" onclick="closeEditModal()">ì·¨ì†Œ</button>
   620	          <button type="submit" class="btn-primary">ì €ì¥</button>
   621	        </div>
   622	      </form>
   623	    </div>
   624	  </div>
   625	
   626	  <script>
   627	    const API_URL = 'https://hanpass-2026-backend.vercel.app/api';
   628	    let allData = { kpis: [], projects: [], schema: {} };
   629	    let previousData = null;
   630	    let schema = {};
   631	
   632	    function updateTimestamp() {
   633	      const now = new Date();
   634	      const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
   635	      document.getElementById('timestamp').textContent = `ë§ˆì§€ë§‰ ë™ê¸°í™”: ì˜¤ëŠ˜ ${timeStr}`;
   636	    }
   637	
   638	    function switchTab(tabName) {
   639	      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
   640	      document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
   641	      
   642	      if (tabName === 'all') {
   643	        document.querySelectorAll('.tab')[0].classList.add('active');
   644	        document.getElementById('all-tab').classList.add('active');
   645	      } else if (tabName === 'updates') {
   646	        document.querySelectorAll('.tab')[1].classList.add('active');
   647	        document.getElementById('updates-tab').classList.add('active');
   648	        loadUpdates();
   649	      }
   650	    }
   651	
   652	    async function loadData() {
   653	      const container = document.getElementById('all-tab');
   654	      container.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';
   655	
   656	      try {
   657	        const response = await fetch(`${API_URL}?type=all&includeContent=true`, {
   658	          cache: 'no-store',
   659	          headers: { 'Cache-Control': 'no-cache' }
   660	        });
   661	
   662	        if (!response.ok) {
   663	          throw new Error(`HTTP ${response.status}`);
   664	        }
   665	
   666	        const apiResponse = await response.json();
   667	        
   668	        if (!apiResponse.success) {
   669	          throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
   670	        }
   671	
   672	        const data = apiResponse.data;
   673	        
   674	        // ìŠ¤í‚¤ë§ˆ ì €ì¥
   675	        schema = data.schema || {};
   676	
   677	        // ì´ì „ ë°ì´í„° ë¡œë“œ
   678	        const savedData = localStorage.getItem('previousData');
   679	        if (savedData) {
   680	          previousData = JSON.parse(savedData);
   681	        }
   682	
   683	        allData = data;
   684	        localStorage.setItem('previousData', JSON.stringify(data));
   685	
   686	        renderAllView(data);
   687	        updateTimestamp();
   688	      } catch (error) {
   689	        console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
   690	        container.innerHTML = `
   691	          <div class="error">
   692	            <strong>ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</strong><br>
   693	            ${error.message}<br><br>
   694	            <button class="btn" onclick="loadData()">ë‹¤ì‹œ ì‹œë„</button>
   695	          </div>
   696	        `;
   697	      }
   698	    }
   699	
   700	    function isWithin7Days(lastEditedTime) {
   701	      if (!lastEditedTime) return false;
   702	      const now = new Date();
   703	      const edited = new Date(lastEditedTime);
   704	      const diffDays = (now - edited) / (1000 * 60 * 60 * 24);
   705	      return diffDays <= 7;
   706	    }
   707	
   708	    function hasChanged(projectId, field, currentValue) {
   709	      if (!previousData || !previousData.projects) return false;
   710	      
   711	      const prevProject = previousData.projects.find(p => p.id === projectId);
   712	      if (!prevProject) return false;
   713	
   714	      const project = allData.projects.find(p => p.id === projectId);
   715	      if (!project || !isWithin7Days(project.lastEditedTime)) return false;
   716	
   717	      return prevProject[field] !== currentValue;
   718	    }
   719	
   720	    function getTimeAgo(dateString) {
   721	      const now = new Date();
   722	      const past = new Date(dateString);
   723	      const diffMs = now - past;
   724	      const diffMins = Math.floor(diffMs / (1000 * 60));
   725	      const diffHours = Math.floor(diffMs / (1000 * 60 * 60));
   726	      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
   727	
   728	      if (diffMins < 60) return `${diffMins}ë¶„ ì „`;
   729	      if (diffHours < 24) return `${diffHours}ì‹œê°„ ì „`;
   730	      return `${diffDays}ì¼ ì „`;
   731	    }
   732	
   733	    function renderAllView(data) {
   734	      const container = document.getElementById('all-tab');
   735	      const { kpis, projects } = data;
   736	
   737	      if (!kpis || !projects) {
   738	        container.innerHTML = '<div class="loading">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
   739	        return;
   740	      }
   741	
   742	      let html = '<div class="kpi-list">';
   743	
   744	      kpis.forEach(kpi => {
   745	        const kpiProjects = projects.filter(p => kpi.projects.includes(p.id));
   746	        
   747	        html += `
   748	          <div class="kpi-group">
   749	            <div class="kpi-header" onclick="toggleKpi('${kpi.id}')">
   750	              <div class="kpi-title">${kpi.name}</div>
   751	              <div style="display: flex; align-items: center;">
   752	                <div class="kpi-count">${kpiProjects.length}ê°œ í”„ë¡œì íŠ¸</div>
   753	                <div class="kpi-arrow">â–¼</div>
   754	              </div>
   755	            </div>
   756	            <div id="kpi-${kpi.id}" class="kpi-details">
   757	        `;
   758	
   759	        // KPI Detailë³„ë¡œ ê·¸ë£¹í™”
   760	        const detailGroups = {};
   761	        kpiProjects.forEach(project => {
   762	          const detail = project.kpiDetail || 'ê¸°íƒ€';
   763	          if (!detailGroups[detail]) {
   764	            detailGroups[detail] = [];
   765	          }
   766	          detailGroups[detail].push(project);
   767	        });
   768	
   769	        Object.entries(detailGroups).forEach(([detail, detailProjects]) => {
   770	          const detailId = `detail-${kpi.id}-${detail.replace(/\s+/g, '-')}`;
   771	          html += `
   772	            <div class="detail-section">
   773	              <div class="detail-header" onclick="toggleDetail('${detailId}')">
   774	                <div class="detail-left">
   775	                  <span class="detail-pin">ğŸ“</span>
   776	                  <span class="detail-title">${detail}</span>
   777	                </div>
   778	                <div style="display: flex; align-items: center;">
   779	                  <span class="detail-count">${detailProjects.length}ê°œ</span>
   780	                  <span class="detail-arrow">â–¼</span>
   781	                </div>
   782	              </div>
   783	              <div id="${detailId}" class="detail-content active">
   784	              <div class="table-container">
   785	                <table>
   786	                  <thead>
   787	                    <tr>
   788	                      <th style="width: 20%">í”„ë¡œì íŠ¸ëª…</th>
   789	                      <th style="width: 15%">ëª©í‘œ</th>
   790	                      <th style="width: 10%">êµ­ê°€</th>
   791	                      <th style="width: 8%">ë¶€ì„œ</th>
   792	                      <th style="width: 8%">ë‹´ë‹¹ì</th>
   793	                      <th style="width: 8%">ìƒíƒœ</th>
   794	                      <th style="width: 8%">ì§„í–‰ë¥ </th>
   795	                      <th style="width: 10%">ë§ˆê°ì¼</th>
   796	                      <th style="width: 5%">ìˆ˜ì •</th>
   797	                    </tr>
   798	                  </thead>
   799	                  <tbody>
   800	          `;
   801	
   802	          detailProjects.forEach(project => {
   803	            const goalClass = hasChanged(project.id, 'goal', project.goal) ? 'changed-value' : '';
   804	            const countryClass = hasChanged(project.id, 'country', project.country) ? 'changed-value' : '';
   805	            const divisionClass = hasChanged(project.id, 'division', project.division) ? 'changed-value' : '';
   806	            const statusClass = hasChanged(project.id, 'status', project.status) ? 'changed-value' : '';
   807	            const progressClass = hasChanged(project.id, 'progress', project.progress) ? 'changed-value' : '';
   808	            const deadlineClass = hasChanged(project.id, 'deadline', project.deadline) ? 'changed-value' : '';
   809	
   810	            html += `
   811	              <tr>
   812	                <td><a href="${project.link || '#'}" target="_blank" class="project-link">${project.name || '-'}</a></td>
   813	                <td><span class="${goalClass}">${project.goal || '-'}</span></td>
   814	                <td><span class="${countryClass}">${project.country || '-'}</span></td>
   815	                <td><span class="${divisionClass}">${project.division || '-'}</span></td>
   816	                <td>${project.owner || '-'}</td>
   817	                <td><span class="${statusClass}">${project.status || '-'}</span></td>
   818	                <td><span class="${progressClass}">${project.progress || 0}%</span></td>
   819	                <td><span class="${deadlineClass}">${project.deadline || '-'}</span></td>
   820	                <td><span class="edit-icon" onclick="openEditModal('${project.id}')">âœï¸</span></td>
   821	              </tr>
   822	            `;
   823	          });
   824	
   825	          html += `
   826	                  </tbody>
   827	                </table>
   828	              </div>
   829	              </div>
   830	            </div>
   831	          `;
   832	        });
   833	
   834	        html += `
   835	            </div>
   836	          </div>
   837	        `;
   838	      });
   839	
   840	      html += '</div>';
   841	      container.innerHTML = html;
   842	    }
   843	
   844	    function toggleKpi(kpiId) {
   845	      const element = document.getElementById(`kpi-${kpiId}`);
   846	      element.classList.toggle('active');
   847	    }
   848	
   849	    function toggleDetail(detailId) {
   850	      const element = document.getElementById(detailId);
   851	      element.classList.toggle('active');
   852	    }
   853	
   854	    function toggleAllKpis(open) {
   855	      document.querySelectorAll('.kpi-details').forEach(el => {
   856	        if (open) {
   857	          el.classList.add('active');
   858	        } else {
   859	          el.classList.remove('active');
   860	        }
   861	      });
   862	      
   863	      document.querySelectorAll('.detail-content').forEach(el => {
   864	        if (open) {
   865	          el.classList.add('active');
   866	        } else {
   867	          el.classList.remove('active');
   868	        }
   869	      });
   870	    }
   871	
   872	    async function loadUpdates() {
   873	      const container = document.getElementById('updates-tab');
   874	      const { projects } = allData;
   875	
   876	      if (!projects) {
   877	        container.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”</div>';
   878	        return;
   879	      }
   880	
   881	      // 7ì¼ ì´ë‚´ ì—…ë°ì´íŠ¸ + ë©”ëª¨ê°€ ìˆëŠ” í”„ë¡œì íŠ¸ë§Œ
   882	      const recentProjects = projects
   883	        .filter(p => isWithin7Days(p.lastEditedTime) && p.content && p.content.trim() !== '')
   884	        .sort((a, b) => new Date(b.lastEditedTime) - new Date(a.lastEditedTime));
   885	
   886	      if (recentProjects.length === 0) {
   887	        container.innerHTML = '<div class="loading">ìµœê·¼ 7ì¼ ì´ë‚´ ë©”ëª¨ê°€ ì—…ë°ì´íŠ¸ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
   888	        return;
   889	      }
   890	
   891	      let html = '<div class="update-list">';
   892	
   893	      recentProjects.forEach(project => {
   894	        const timeAgo = getTimeAgo(project.lastEditedTime);
   895	        
   896	        html += `
   897	          <div class="update-card">
   898	            <h3>
   899	              ${project.name}
   900	              <span class="update-time">${timeAgo}</span>
   901	            </h3>
   902	            <div class="update-content">
   903	              <p><strong>ëª©í‘œ:</strong> ${project.goal || '-'}</p>
   904	              <p><strong>ìƒíƒœ:</strong> ${project.status || '-'} | <strong>ì§„í–‰ë¥ :</strong> ${project.progress || 0}%</p>
   905	              <div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 0.9em; white-space: pre-wrap;">${project.content}</div>
   906	              <a href="${project.link || '#'}" target="_blank" class="notion-link">ë…¸ì…˜ì—ì„œ ì „ì²´ ë³´ê¸° â†’</a>
   907	            </div>
   908	          </div>
   909	        `;
   910	      });
   911	
   912	      html += '</div>';
   913	      container.innerHTML = html;
   914	    }
   915	
   916	    function openEditModal(projectId) {
   917	      const project = allData.projects.find(p => p.id === projectId);
   918	      if (!project) return;
   919	
   920	      document.getElementById('edit-project-id').value = project.id;
   921	      document.getElementById('edit-name').value = project.name || '';
   922	      document.getElementById('edit-goal').value = project.goal || '';
   923	      document.getElementById('edit-owner').value = project.owner || '';
   924	      document.getElementById('edit-progress').value = project.progress || 0;
   925	      document.getElementById('edit-deadline').value = project.deadline || '';
   926	
   927	      // êµ­ê°€ ì˜µì…˜
   928	      const countrySelect = document.getElementById('edit-country');
   929	      countrySelect.innerHTML = '';
   930	      if (schema.countries && schema.countries.length > 0) {
   931	        schema.countries.forEach(country => {
   932	          const option = document.createElement('option');
   933	          option.value = country.name;
   934	          option.textContent = country.name;
   935	          const selectedCountries = (project.country || '').split(',').map(c => c.trim());
   936	          if (selectedCountries.includes(country.name)) {
   937	            option.selected = true;
   938	          }
   939	          countrySelect.appendChild(option);
   940	        });
   941	      }
   942	
   943	      // ë¶€ì„œ ì˜µì…˜
   944	      const divisionSelect = document.getElementById('edit-division');
   945	      divisionSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
   946	      if (schema.divisions && schema.divisions.length > 0) {
   947	        schema.divisions.forEach(division => {
   948	          const option = document.createElement('option');
   949	          option.value = division.name;
   950	          option.textContent = division.name;
   951	          if (project.division === division.name) {
   952	            option.selected = true;
   953	          }
   954	          divisionSelect.appendChild(option);
   955	        });
   956	      }
   957	
   958	      // ìƒíƒœ ì˜µì…˜
   959	      const statusSelect = document.getElementById('edit-status');
   960	      statusSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
   961	      if (schema.statuses && schema.statuses.length > 0) {
   962	        schema.statuses.forEach(status => {
   963	          const option = document.createElement('option');
   964	          option.value = status.name;
   965	          option.textContent = status.name;
   966	          if (project.status === status.name) {
   967	            option.selected = true;
   968	          }
   969	          statusSelect.appendChild(option);
   970	        });
   971	      }
   972	
   973	      document.getElementById('edit-modal').classList.add('active');
   974	    }
   975	
   976	    function closeEditModal() {
   977	      document.getElementById('edit-modal').classList.remove('active');
   978	    }
   979	
   980	    async function handleEditSubmit(event) {
   981	      event.preventDefault();
   982	
   983	      const projectId = document.getElementById('edit-project-id').value;
   984	      const goal = document.getElementById('edit-goal').value;
   985	      const countryOptions = document.getElementById('edit-country').selectedOptions;
   986	      const country = Array.from(countryOptions).map(opt => opt.value);
   987	      const division = document.getElementById('edit-division').value;
   988	      const status = document.getElementById('edit-status').value;
   989	      const progress = parseInt(document.getElementById('edit-progress').value);
   990	      const deadline = document.getElementById('edit-deadline').value;
   991	
   992	      try {
   993	        const response = await fetch(API_URL, {
   994	          method: 'POST',
   995	          headers: { 'Content-Type': 'application/json' },
   996	          body: JSON.stringify({
   997	            projectId,
   998	            goal,
   999	            country,
  1000	            division,
  1001	            status,
  1002	            progress,
  1003	            deadline
  1004	          })
  1005	        });
  1006	
  1007	        const result = await response.json();
  1008	
  1009	        if (result.success) {
  1010	          alert('í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
  1011	          closeEditModal();
  1012	          loadData();
  1013	        } else {
  1014	          alert('ìˆ˜ì • ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
  1015	        }
  1016	      } catch (error) {
  1017	        console.error('ìˆ˜ì • ì˜¤ë¥˜:', error);
  1018	        alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
  1019	      }
  1020	    }
  1021	
  1022	    // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
  1023	    document.getElementById('edit-modal').addEventListener('click', function(e) {
  1024	      if (e.target === this) {
  1025	        closeEditModal();
  1026	      }
  1027	    });
  1028	
  1029	    // ì´ˆê¸° ë¡œë“œ
  1030	    loadData();
  1031	  </script>
  1032	</body>
  1033	</html>
