<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HanPass 2026 Dashboard</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #f5f7fa;
      color: #333;
      line-height: 1.6;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background: white;
      padding: 20px;
      border-radius: 12px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
    }

    header h1 {
      color: #2c3e50;
      font-size: 1.5em;
    }

    .header-right {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .btn {
      background: #2196F3;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 600;
      transition: background 0.2s;
    }

    .btn:hover {
      background: #1976D2;
    }

    .timestamp {
      color: #999;
      font-size: 0.85em;
    }

    .vision-banner {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      font-size: 1.1em;
      font-weight: 700;
      color: white;
      margin-bottom: 20px;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
      border-bottom: 2px solid #e5e5e5;
    }

    .tab {
      background: transparent;
      border: none;
      padding: 12px 24px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 600;
      color: #666;
      border-bottom: 3px solid transparent;
      transition: all 0.2s;
    }

    .tab.active {
      color: #2196F3;
      border-bottom-color: #2196F3;
    }

    .tab:hover {
      color: #2196F3;
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    .kpi-group {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .kpi-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      padding: 10px;
      border-radius: 8px;
      transition: background 0.2s;
    }

    .kpi-header:hover {
      background: #f8f9fa;
    }

    .kpi-title {
      font-size: 1.3em;
      font-weight: 700;
      color: #2c3e50;
    }

    .kpi-count {
      background: #2196F3;
      color: white;
      padding: 5px 15px;
      border-radius: 20px;
      font-size: 0.9em;
      font-weight: 600;
      margin-right: 10px;
    }

    .kpi-arrow {
      font-size: 1.2em;
      color: #666;
      transition: transform 0.3s;
      display: inline-block;
    }

    .kpi-details {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .kpi-details.active {
      max-height: 10000px;
      transition: max-height 0.5s ease-in;
    }

    .kpi-details.active + .kpi-header .kpi-arrow {
      transform: rotate(180deg);
    }

    .detail-section {
      margin-top: 15px;
      padding-top: 15px;
      border-top: 2px solid #f0f0f0;
    }

    .detail-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 10px;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .detail-header:hover {
      background: #e9ecef;
    }

    .detail-left {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
    }

    .detail-pin {
      font-size: 1.2em;
    }

    .detail-title {
      font-size: 1.1em;
      font-weight: 600;
      color: #555;
    }

    .detail-count {
      color: #2196F3;
      font-weight: 600;
      margin-right: 10px;
    }

    .detail-arrow {
      font-size: 1.1em;
      color: #888;
      transition: transform 0.3s;
      display: inline-block;
    }

    .detail-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.3s ease-out;
    }

    .detail-content.active {
      max-height: 5000px;
      transition: max-height 0.5s ease-in;
    }

    .detail-content.active + .detail-header .detail-arrow {
      transform: rotate(180deg);
    }

    .table-container {
      overflow-x: auto;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }

    th, td {
      padding: 12px;
      text-align: left;
      border-bottom: 1px solid #e5e5e5;
    }

    th {
      background: #f8f9fa;
      color: #555;
      font-weight: 600;
      font-size: 0.9em;
    }

    td {
      font-size: 0.9em;
      color: #666;
    }

    .project-link {
      color: #2196F3;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
    }

    .project-link:hover {
      color: #1976D2;
      text-decoration: underline;
    }

    .changed-value {
      color: #2196F3;
      font-weight: 600;
      position: relative;
    }

    .changed-value::after {
      content: 'ë³€ê²½ë¨';
      background: #2196F3;
      color: white;
      font-size: 10px;
      padding: 2px 6px;
      border-radius: 10px;
      margin-left: 6px;
    }

    .edit-icon {
      cursor: pointer;
      font-size: 1.2em;
      transition: transform 0.2s;
    }

    .edit-icon:hover {
      transform: scale(1.2);
    }

    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
      z-index: 1000;
      justify-content: center;
      align-items: center;
    }

    .modal.active {
      display: flex;
    }

    .modal-content {
      background: white;
      border-radius: 12px;
      padding: 30px;
      width: 90%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .modal-header h2 {
      color: #2c3e50;
    }

    .close-btn {
      background: none;
      border: none;
      font-size: 1.5em;
      cursor: pointer;
      color: #999;
    }

    .close-btn:hover {
      color: #333;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #555;
    }

    .form-group input,
    .form-group select {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 0.95em;
    }

    .form-group input[readonly] {
      background: #f5f5f5;
      color: #999;
    }

    .form-group select[multiple] {
      height: 120px;
    }

    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 30px;
    }

    .btn-primary {
      background: #2196F3;
      color: white;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-primary:hover {
      background: #1976D2;
    }

    .btn-secondary {
      background: #f0f0f0;
      color: #666;
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-weight: 600;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    .update-list {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .update-card {
      background: white;
      border: 1px solid #e5e5e5;
      border-radius: 8px;
      padding: 20px;
      border-left: 4px solid #2196F3;
    }

    .update-card h3 {
      color: #333;
      margin-bottom: 10px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 1.1em;
    }

    .update-time {
      font-size: 0.85em;
      color: #999;
      font-weight: normal;
    }

    .update-content {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #f0f0f0;
      font-size: 0.95em;
      color: #666;
    }

    .notion-link {
      display: inline-block;
      margin-top: 10px;
      color: #2196F3;
      text-decoration: none;
      font-weight: 600;
      font-size: 0.9em;
    }

    .notion-link:hover {
      text-decoration: underline;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #999;
    }

    .error {
      background: #ffebee;
      border: 1px solid #ef5350;
      border-radius: 8px;
      padding: 15px;
      color: #c62828;
      margin: 20px 0;
    }

    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }

      header {
        flex-direction: column;
        gap: 10px;
        align-items: flex-start;
      }

      header h1 {
        font-size: 1.2em;
      }

      .header-right {
        width: 100%;
        justify-content: space-between;
      }

      .tabs {
        overflow-x: auto;
        -webkit-overflow-scrolling: touch;
      }

      .tab {
        white-space: nowrap;
        font-size: 0.9em;
        padding: 10px 15px;
      }

      .table-container {
        overflow-x: scroll;
      }

      table {
        font-size: 0.8em;
      }

      .modal-content {
        padding: 20px;
        width: 95%;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>ğŸš€ HanPass 2026 Dashboard</h1>
      <div class="header-right">
        <button class="btn" onclick="toggleAllKpis(true)">ğŸ“‚ ì „ì²´ ì—´ê¸°</button>
        <button class="btn" onclick="toggleAllKpis(false)">ğŸ“ ì „ì²´ ë‹«ê¸°</button>
        <button class="btn" onclick="loadData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
        <span class="timestamp" id="timestamp"></span>
      </div>
    </header>

    <div class="vision-banner">
      ì†ë„ë¡œ ì¥ì•…í•˜ê³  ê²©ì°¨ë¡œ ëë‚¸ë‹¤
    </div>

    <div class="tabs">
      <button class="tab active" onclick="switchTab('all')">ğŸ“Š ì „ì²´ ë³´ê¸°</button>
      <button class="tab" onclick="switchTab('updates')">ğŸ“ ì—…ë°ì´íŠ¸ ëª¨ì•„ë³´ê¸°</button>
    </div>

    <div id="all-tab" class="tab-content active">
      <div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>

    <div id="updates-tab" class="tab-content">
      <div class="loading">ì—…ë°ì´íŠ¸ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
    </div>
  </div>

  <div id="edit-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2>í”„ë¡œì íŠ¸ ìˆ˜ì •</h2>
        <button class="close-btn" onclick="closeEditModal()">&times;</button>
      </div>
      <form id="edit-form" onsubmit="handleEditSubmit(event)">
        <input type="hidden" id="edit-project-id">
        
        <div class="form-group">
          <label>í”„ë¡œì íŠ¸ëª… (ì½ê¸° ì „ìš©)</label>
          <input type="text" id="edit-name" readonly>
        </div>

        <div class="form-group">
          <label>ëª©í‘œ</label>
          <input type="text" id="edit-goal">
        </div>

        <div class="form-group">
          <label>êµ­ê°€ (ë‹¤ì¤‘ì„ íƒ)</label>
          <select id="edit-country" multiple></select>
        </div>

        <div class="form-group">
          <label>ë¶€ì„œ</label>
          <select id="edit-division"></select>
        </div>

        <div class="form-group">
          <label>ë‹´ë‹¹ì (ì½ê¸° ì „ìš©)</label>
          <input type="text" id="edit-owner" readonly>
        </div>

        <div class="form-group">
          <label>ìƒíƒœ</label>
          <select id="edit-status"></select>
        </div>

        <div class="form-group">
          <label>ì§„í–‰ë¥  (%)</label>
          <input type="number" id="edit-progress" min="0" max="100">
        </div>

        <div class="form-group">
          <label>ë§ˆê°ì¼</label>
          <input type="date" id="edit-deadline">
        </div>

        <div class="form-actions">
          <button type="button" class="btn-secondary" onclick="closeEditModal()">ì·¨ì†Œ</button>
          <button type="submit" class="btn-primary">ì €ì¥</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    var API_URL = 'https://hanpass-2026-backend.vercel.app/api';
    var allData = { kpis: [], projects: [], schema: {} };
    var previousData = null;
    var schema = {};

    function updateTimestamp() {
      var now = new Date();
      var timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
      document.getElementById('timestamp').textContent = 'ë§ˆì§€ë§‰ ë™ê¸°í™”: ì˜¤ëŠ˜ ' + timeStr;
    }

    function switchTab(tabName) {
      document.querySelectorAll('.tab').forEach(function(t) { t.classList.remove('active'); });
      document.querySelectorAll('.tab-content').forEach(function(c) { c.classList.remove('active'); });
      
      if (tabName === 'all') {
        document.querySelectorAll('.tab')[0].classList.add('active');
        document.getElementById('all-tab').classList.add('active');
      } else if (tabName === 'updates') {
        document.querySelectorAll('.tab')[1].classList.add('active');
        document.getElementById('updates-tab').classList.add('active');
        loadUpdates();
      }
    }

    async function loadData() {
      var container = document.getElementById('all-tab');
      container.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>';

      try {
        var response = await fetch(API_URL + '?type=all&includeContent=true', {
          cache: 'no-store',
          headers: { 'Cache-Control': 'no-cache' }
        });

        if (!response.ok) {
          throw new Error('HTTP ' + response.status);
        }

        var apiResponse = await response.json();
        
        if (!apiResponse.success) {
          throw new Error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨');
        }

        var data = apiResponse.data;
        
        schema = data.schema || {};

        var savedData = localStorage.getItem('previousData');
        if (savedData) {
          previousData = JSON.parse(savedData);
        }

        allData = data;
        localStorage.setItem('previousData', JSON.stringify(data));

        renderAllView(data);
        updateTimestamp();
      } catch (error) {
        console.error('âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
        container.innerHTML = '<div class="error"><strong>ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨</strong><br>' + error.message + '<br><br><button class="btn" onclick="loadData()">ë‹¤ì‹œ ì‹œë„</button></div>';
      }
    }

    function isWithin7Days(lastEditedTime) {
      if (!lastEditedTime) return false;
      var now = new Date();
      var edited = new Date(lastEditedTime);
      var diffDays = (now - edited) / (1000 * 60 * 60 * 24);
      return diffDays <= 7;
    }

    function hasChanged(projectId, field, currentValue) {
      if (!previousData || !previousData.projects) return false;
      
      var prevProject = previousData.projects.find(function(p) { return p.id === projectId; });
      if (!prevProject) return false;

      var project = allData.projects.find(function(p) { return p.id === projectId; });
      if (!project || !isWithin7Days(project.lastEditedTime)) return false;

      return prevProject[field] !== currentValue;
    }

    function getTimeAgo(dateString) {
      var now = new Date();
      var past = new Date(dateString);
      var diffMs = now - past;
      var diffMins = Math.floor(diffMs / (1000 * 60));
      var diffHours = Math.floor(diffMs / (1000 * 60 * 60));
      var diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));

      if (diffMins < 60) return diffMins + 'ë¶„ ì „';
      if (diffHours < 24) return diffHours + 'ì‹œê°„ ì „';
      return diffDays + 'ì¼ ì „';
    }

    function renderAllView(data) {
      var container = document.getElementById('all-tab');
      var kpis = data.kpis;
      var projects = data.projects;

      if (!kpis || !projects) {
        container.innerHTML = '<div class="loading">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      var html = '<div class="kpi-list">';

      kpis.forEach(function(kpi) {
        var kpiProjects = projects.filter(function(p) { 
          return kpi.projects.some(function(rel) { return rel.id === p.id; });
        });
        
        html += '<div class="kpi-group"><div class="kpi-header" onclick="toggleKpi(\'' + kpi.id + '\')"><div class="kpi-title">' + kpi.name + '</div><div style="display: flex; align-items: center;"><div class="kpi-count">' + kpiProjects.length + 'ê°œ í”„ë¡œì íŠ¸</div><div class="kpi-arrow">â–¼</div></div></div><div id="kpi-' + kpi.id + '" class="kpi-details">';

        var detailGroups = {};
        kpiProjects.forEach(function(project) {
          var detail = project.kpiDetail || 'ê¸°íƒ€';
          if (!detailGroups[detail]) {
            detailGroups[detail] = [];
          }
          detailGroups[detail].push(project);
        });

        Object.entries(detailGroups).forEach(function(entry) {
          var detail = entry[0];
          var detailProjects = entry[1];
          var detailId = 'detail-' + kpi.id + '-' + detail.replace(/\s+/g, '-');
          
          html += '<div class="detail-section"><div class="detail-header" onclick="toggleDetail(\'' + detailId + '\')"><div class="detail-left"><span class="detail-pin">ğŸ“</span><span class="detail-title">' + detail + '</span></div><div style="display: flex; align-items: center;"><span class="detail-count">' + detailProjects.length + 'ê°œ</span><span class="detail-arrow">â–¼</span></div></div><div id="' + detailId + '" class="detail-content active"><div class="table-container"><table><thead><tr><th style="width: 20%">í”„ë¡œì íŠ¸ëª…</th><th style="width: 15%">ëª©í‘œ</th><th style="width: 10%">êµ­ê°€</th><th style="width: 8%">ë¶€ì„œ</th><th style="width: 8%">ë‹´ë‹¹ì</th><th style="width: 8%">ìƒíƒœ</th><th style="width: 8%">ì§„í–‰ë¥ </th><th style="width: 10%">ë§ˆê°ì¼</th><th style="width: 5%">ìˆ˜ì •</th></tr></thead><tbody>';

          detailProjects.forEach(function(project) {
            var goalClass = hasChanged(project.id, 'goal', project.goal) ? 'changed-value' : '';
            var countryClass = hasChanged(project.id, 'country', project.country) ? 'changed-value' : '';
            var divisionClass = hasChanged(project.id, 'division', project.division) ? 'changed-value' : '';
            var statusClass = hasChanged(project.id, 'status', project.status) ? 'changed-value' : '';
            var progressClass = hasChanged(project.id, 'progress', project.progress) ? 'changed-value' : '';
            var deadlineClass = hasChanged(project.id, 'deadline', project.deadline) ? 'changed-value' : '';

            html += '<tr><td><a href="' + (project.link || '#') + '" target="_blank" class="project-link">' + (project.name || '-') + '</a></td><td><span class="' + goalClass + '">' + (project.goal || '-') + '</span></td><td><span class="' + countryClass + '">' + (project.country || '-') + '</span></td><td><span class="' + divisionClass + '">' + (project.division || '-') + '</span></td><td>' + (project.owner || '-') + '</td><td><span class="' + statusClass + '">' + (project.status || '-') + '</span></td><td><span class="' + progressClass + '">' + (project.progress || 0) + '%</span></td><td><span class="' + deadlineClass + '">' + (project.deadline || '-') + '</span></td><td><span class="edit-icon" onclick="openEditModal(\'' + project.id + '\')">âœï¸</span></td></tr>';
          });

          html += '</tbody></table></div></div></div>';
        });

        html += '</div></div>';
      });

      html += '</div>';
      container.innerHTML = html;
    }

    function toggleKpi(kpiId) {
      var element = document.getElementById('kpi-' + kpiId);
      element.classList.toggle('active');
    }

    function toggleDetail(detailId) {
      var element = document.getElementById(detailId);
      element.classList.toggle('active');
    }

    function toggleAllKpis(open) {
      document.querySelectorAll('.kpi-details').forEach(function(el) {
        if (open) {
          el.classList.add('active');
        } else {
          el.classList.remove('active');
        }
      });
      
      document.querySelectorAll('.detail-content').forEach(function(el) {
        if (open) {
          el.classList.add('active');
        } else {
          el.classList.remove('active');
        }
      });
    }

    async function loadUpdates() {
      var container = document.getElementById('updates-tab');
      var projects = allData.projects;

      if (!projects) {
        container.innerHTML = '<div class="loading">ë°ì´í„°ë¥¼ ë¨¼ì € ë¡œë“œí•´ì£¼ì„¸ìš”</div>';
        return;
      }

      var recentProjects = projects
        .filter(function(p) { return isWithin7Days(p.lastEditedTime) && p.content && p.content.trim() !== ''; })
        .sort(function(a, b) { return new Date(b.lastEditedTime) - new Date(a.lastEditedTime); });

      if (recentProjects.length === 0) {
        container.innerHTML = '<div class="loading">ìµœê·¼ 7ì¼ ì´ë‚´ ë©”ëª¨ê°€ ì—…ë°ì´íŠ¸ëœ í”„ë¡œì íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
        return;
      }

      var html = '<div class="update-list">';

      recentProjects.forEach(function(project) {
        var timeAgo = getTimeAgo(project.lastEditedTime);
        
        html += '<div class="update-card"><h3>' + project.name + '<span class="update-time">' + timeAgo + '</span></h3><div class="update-content"><p><strong>ëª©í‘œ:</strong> ' + (project.goal || '-') + '</p><p><strong>ìƒíƒœ:</strong> ' + (project.status || '-') + ' | <strong>ì§„í–‰ë¥ :</strong> ' + (project.progress || 0) + '%</p><div style="margin-top: 10px; padding: 10px; background: #f8f9fa; border-radius: 6px; font-size: 0.9em; white-space: pre-wrap;">' + project.content + '</div><a href="' + (project.link || '#') + '" target="_blank" class="notion-link">ë…¸ì…˜ì—ì„œ ì „ì²´ ë³´ê¸° â†’</a></div></div>';
      });

      html += '</div>';
      container.innerHTML = html;
    }

    function openEditModal(projectId) {
      var project = allData.projects.find(function(p) { return p.id === projectId; });
      if (!project) return;

      document.getElementById('edit-project-id').value = project.id;
      document.getElementById('edit-name').value = project.name || '';
      document.getElementById('edit-goal').value = project.goal || '';
      document.getElementById('edit-owner').value = project.owner || '';
      document.getElementById('edit-progress').value = project.progress || 0;
      document.getElementById('edit-deadline').value = project.deadline || '';

      var countrySelect = document.getElementById('edit-country');
      countrySelect.innerHTML = '';
      if (schema.countries && schema.countries.length > 0) {
        schema.countries.forEach(function(country) {
          var option = document.createElement('option');
          option.value = country.name;
          option.textContent = country.name;
          var selectedCountries = (project.country || '').split(',').map(function(c) { return c.trim(); });
          if (selectedCountries.includes(country.name)) {
            option.selected = true;
          }
          countrySelect.appendChild(option);
        });
      }

      var divisionSelect = document.getElementById('edit-division');
      divisionSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
      if (schema.divisions && schema.divisions.length > 0) {
        schema.divisions.forEach(function(division) {
          var option = document.createElement('option');
          option.value = division.name;
          option.textContent = division.name;
          if (project.division === division.name) {
            option.selected = true;
          }
          divisionSelect.appendChild(option);
        });
      }

      var statusSelect = document.getElementById('edit-status');
      statusSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>';
      if (schema.statuses && schema.statuses.length > 0) {
        schema.statuses.forEach(function(status) {
          var option = document.createElement('option');
          option.value = status.name;
          option.textContent = status.name;
          if (project.status === status.name) {
            option.selected = true;
          }
          statusSelect.appendChild(option);
        });
      }

      document.getElementById('edit-modal').classList.add('active');
    }

    function closeEditModal() {
      document.getElementById('edit-modal').classList.remove('active');
    }

    async function handleEditSubmit(event) {
      event.preventDefault();

      var projectId = document.getElementById('edit-project-id').value;
      var goal = document.getElementById('edit-goal').value;
      var countryOptions = document.getElementById('edit-country').selectedOptions;
      var country = Array.from(countryOptions).map(function(opt) { return opt.value; });
      var division = document.getElementById('edit-division').value;
      var status = document.getElementById('edit-status').value;
      var progress = parseInt(document.getElementById('edit-progress').value);
      var deadline = document.getElementById('edit-deadline').value;

      try {
        var response = await fetch(API_URL, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            projectId: projectId,
            goal: goal,
            country: country,
            division: division,
            status: status,
            progress: progress,
            deadline: deadline
          })
        });

        var result = await response.json();

        if (result.success) {
          alert('í”„ë¡œì íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!');
          closeEditModal();
          loadData();
        } else {
          alert('ìˆ˜ì • ì‹¤íŒ¨: ' + (result.error || 'ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜'));
        }
      } catch (error) {
        console.error('ìˆ˜ì • ì˜¤ë¥˜:', error);
        alert('ìˆ˜ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    }

    document.getElementById('edit-modal').addEventListener('click', function(e) {
      if (e.target === this) {
        closeEditModal();
      }
    });

    loadData();
  </script>
</body>
</html>
